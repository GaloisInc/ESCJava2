
(* Trains *)

let train(stationX stationY XYatX XYatY tripTime) =
  new moving.
    moving[ rec T.
      be XYatX. wait 2.0.
      be moving. do out stationX. wait tripTime. do in stationY. 
      be XYatY. wait 2.0. 
      be moving. do out stationY. wait tripTime. do in stationX.
      T ];

new stationA stationB stationC ABatA ABatB BCatB BCatC.

  stationA[ train(stationA stationB ABatA ABatB 10.0) ] |
  stationB[ train(stationB stationC BCatB BCatC 20.0) ] |
  stationC[ train(stationC stationB BCatC BCatB 30.0) ] |

new joe.
  joe[
    do in stationA. 
    "--- Departing from A". 
    do in ABatA. do out ABatB. 
    "--- Changing at B". 
    do in BCatB. do out BCatC. 
    "--- Arriving at C". 
    do out stationC] |

new nancy.
  nancy[
    do in stationC. 
    "--- Departing from C". 
    do in BCatC. do out BCatB. 
    "--- Changing at B". 
    do in ABatB. do out ABatA. 
    "--- Arriving at A". 
    do out stationA]

